---
title: "ESLint et Prettier"
slug: "eslint-prettier"
marmelab:
date: "2018-03-04"
description: "Lorsque je lance un nouveau projet, les premières étapes sont souvent les mêmes : je crée un repository, je bootstrap les bases du projet (yarn add express, create-react-app webapp, ...), et j’ouvre le projet dans VSCode. Bien souvent, l’indentation et autre 'doubleQuote' me rappellent la prochaine étape : mettre en place les règles d'ESLint."
tags:
- toolbox
- eslint
- prettier
---


# C'est quoi un linter ?

> Lint (logiciel) lint (en lettres minuscules ; de l'anglais lint : « touffe hirsute » ) est une commande UNIX de préprocesseur permettant l'analyse statique de code source en langage C.
> *Wikipedia*

Un linter est donc un outil qui va permettre d'analyser du code et vérifier s’il respecte un certain nombre de règles de syntaxe et de qualité.

En JavaScript, le linter le plus connu est certainement [`Eslint`](https://eslint.org), dont l'un des points fort est sa configuration. Il est tellement configurable que j'ai bien souvent copier/coller la conf. d'un projet précédent pour le mettre en place, pour ensuite perdre du temps à installer des plug-ins manquants, rajouter des règles pour activer ou désactiver des alertes intempestives...

Pour se faciliter la vie, il vaut donc mieux reprendre les choses à zero, bien comprendre le fonctionnement, et n'installer que le strict minimum, quitte à devoir rajouter des règles et autre plugins au fur et à mesure.

## Installation et utilisation

`Eslint` peut-être installer en global ou au niveau d'un projet. Personnellement, et parce que chaque projet va requerire ses propres règles et souvent ses propres plugins, je préfère l'installer au niveau du projet, voir de chaque partie du projet. 

```bash
yarn add -D eslint
```

Une fois installé, on a accès à l'utilitaire depuis la ligne de commande :

```bash
❯ node_modules/.bin/eslint index.js

/home/alexis/Code/Sandbox/javascript-playground/services/express_server/index.js
  6:3  error  Insert `··`  prettier/prettier

✖ 1 problem (1 error, 0 warnings)
  1 error, 0 warnings potentially fixable with the `--fix` option.
```

On voit donc les erreurs éventuelles présentes dans `index.js`, ce qui est bien, mais certainement pas suffisant.

On pourrait décider de lancer Eslint à chaque fois que l'on ajoute du code au repository ([Pre-commit Hook](https://prettier.io/docs/en/precommit.html)). Cela peut sûrement être utile, mais je n'aime pas l'idée d'avoir du code ajouter au repo avec un formatage que je n'aurais pas vu au préalable. Non, c'est selon moi au niveau de l'éditeur que le linter doit agir.

Et si vous êtes sous VSCode, c'est très simple avec le plugin [VS Code ESLint extension](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint). Si vous utilisez un autre éditeur, il y a de forte chance que ESLint [puisse aussi y être intégré](https://eslint.org/docs/user-guide/integrations).

Et toujours pour une affaire de goût, j'aime activer le formatage automatique du code à la sauvegarde.

```json
// in $HOME/.config/Code/User/settings.json
"eslint.autoFixOnSave": true,
```

## Configuration de base

Le linter est installé et l'IDE configuré pour l'utiliser. Il est maintenant temps de le configurer, via un fichier `.eslintrc`

```json
// in .eslintrc
{
    "parser": "Espree", // Le parser utiliser pour analyser le code
    "parserOptions": {}, // Les options éventuelles passées au parser
    "env": {}, // Déclaration d'un environnement permettant de déclarer des variables globales préconfigurées
    "globals": {}, // Déclaration de variables globales personnalisées
    "plugins": [], // Déclaration et configuration des plugins
    "extends": [], // Déclaration d'une pré-configuration complête d'eslint
    "rules": {}, // Surcharge des règles appliquées par défaut par ESLint ou par un plugin
}
```

Sur un projet basique au plus prêt du standard Javascript supporté par le node ou le navigateur utilisé (donc pas de [`Babel`](https://babeljs.io/)), la configuration par défault est presque suffisante : 

```json
{
    "env": {
        "es6": true,
        "node": true,
    }
}
```

![Linted !](/images/linter/simpleEslintConfig.png)

Mais l'application de le configuration ***recommandée*** par ESLint apporte quand même du mieux :

```json
{
    "env": {
        "es6": true,
        "node": true,
    },
    "extends": [
        "eslint:recommended",
    ]
}
```

![Much better Linted !](/images/linter/recomandedEslintConfig.png)

### Une application CRA (create-react-app)

Pour pouvoir utiliser ESLint depuis VSCode sur un application CRA, il va falloir déclarer son propre fichier de configuration, sauf à vouloir passer par un `create-react-app eject` pour acceder à la configuration mise en place par l'équipe de Facebook. Et ce type de projet est beaucoup plus compliqué que celui évoqué précédemment : passage par un phase de transpilation avec Babel (il faut donc changer de parser), présence de `jsx` et son lot de `rules` à définir ...

Mais, et merci à eux, l'équipe de Facebook met à disposition une configuration déjà toute prête : [`eslint-config-react-app`](https://www.npmjs.com/package/eslint-config-react-app). Alors, il va falloir installer pas mal de chose ...

```bash
yarn add -D eslint-config-react-app babel-eslint@^7.2.3 eslint@^4.1.1 eslint-plugin-flowtype@^2.34.1 eslint-plugin-import@^2.6.0 eslint-plugin-jsx-a11y@^5.1.1 eslint-plugin-react@^7.1.0
```

...mais cela fait, le configuration reste très simple grâce à `extends` :

```json
{
    "env": {
        "es6": true,
        "jest": true
    },
    "extends": ["react-app"],
}
```

On applique maintenant les mêmes règles de syntaxe dans VSCode que celles "requises" par CRA. Voyons par exemple le fichier App.js avec notre configuration précédente:

![CRA basic config !](/images/linter/basicCRAConfig.png)

Maintenant avec

![CRA with good config !](/images/linter/officialCRAConfig.png)

Les `import` sont valides, et ceci parce que on n'utilise plus le parser `Espree` mais `babel-eslint` ! Comment on peut le savoir ? Comme bien souvent, en regardant dans le code du plugin, où l'on va retrouver la configuration complète d'ESLint. Et c'est du serieux:

```javascript
// in node_modules/eslint-config-react-app/index.js
module.exports = {
  root: true,

  parser: 'babel-eslint',

  plugins: ['import', 'flowtype', 'jsx-a11y', 'react'],

  env: {
    browser: true,
    commonjs: true,
    es6: true,
    jest: true,
    node: true,
  },

  parserOptions: {
    ecmaVersion: 6,
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true,
      generators: true,
      experimentalObjectRestSpread: true,
    },
  },

  rules: {
    // http://eslint.org/docs/rules/
    'array-callback-return': 'warn',
    'default-case': ['warn', { commentPattern: '^no default$' }],

    ...

    'jsx-a11y/role-supports-aria-props': 'warn',
    'jsx-a11y/scope': 'warn',
    // https://github.com/gajus/eslint-plugin-flowtype
    'flowtype/define-flow-type': 'warn',
    'flowtype/require-valid-file-annotation': 'warn',
    'flowtype/use-flow-type': 'warn',
  },
};
```


## Prettier

ESLint fait maintenant un super boulot, mais pèche un peu sur le formattage du code. Ce doit être améliorable en définissant des `rules` spécifique, mais il existe un autre projet, [`Prettier`](https://prettier.io/) justement spécialisé dans le formatage du code. Il est complêtement indépendant d'ESLint et utilise son propre parser et ses propres règles.    
Il va donc falloir ajouter une deuxième configuration et appliquer un second outil sur le code ? Et ne risquent-ils pas de se marcher sur le pied ? Et bien si, il pourrait effectivement se concurencer. Mais comme le monde du JavaScript est un monde merveilleux, [ESLint et Prettier peuvent fonctionner l'un avec l'autre](https://prettier.io/docs/en/eslint.html), ESLint étant capable de donner le relais à Prettier pour tout ce qui concerne le formattage du code, et uniquement cela. Et encore un fois, on passe par une configuration `extens` ;

```
yarn add -D prettier eslint-plugin-prettier eslint-config-prettier
```

Et après quelques ajouts de règles pour avoir un formattage de code correspondant à mes habitudes :

```json
// in .eslintrc
{
    "env": {
        "es6": true,
        "node": true
    },
    "extends": [
        "eslint:recommended",
        "plugin:prettier/recommended"
    ],
    "rules": {
        "prettier/prettier": ["error", {
            "singleQuote": true,
            "tabWidth": 4,
            "trailingComma": "all"
        }]
    }
}
```


## Encore plus ?

Le configuration précédente est déja très efficace ! Et bien qu'il faille sans doute être raisonnable sur l'ajout de plugin, je complèterais quand même ce set de configuration minimal d'ESLint par un dernier plugin, [`eslint-plugin-jest`](https://www.npmjs.com/package/eslint-plugin-jest) :

```json
{
    "env": {
        "es6": true,
        "node": true,
        "jest": true
    },
    "extends": [
        "eslint:recommended",
        "plugin:prettier/recommended",
        "plugin:jest/recommended"
    ],
    "rules": {
        "prettier/prettier": ["error", {
            "singleQuote": true,
            "tabWidth": 4,
            "trailingComma": "all"
        }],
        "jest/consistent-test-it": [
            "error",
            {"fn": "it"}
        ]
    }
}
```

## Conclusion

Commencer petit autant que possible, ne rajouter de nouveaux parser qu'en cas de réel besoin, 

Par exemple pour un projet sans Babel

Pour un projet Create-react-app

 
mais pas de copier coller

On depend beaucoup de choix de syntaxe d'autres personne. Oui, mais c'est de l'open-sources, et aucun doute sur la prise en compte de remarques faites par une très grosse quantité de dev ! On a donc des règles communes qui émèrge ! et le code-styling étant parfois une affaire subjective, c'est je trouve un bon choix


## Pour suivre
twitter eslint https://twitter.com/geteslint
twitter prettier https://twitter.com/PrettierCode


