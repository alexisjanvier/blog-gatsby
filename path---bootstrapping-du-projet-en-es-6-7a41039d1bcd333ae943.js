webpackJsonp([0x2fb981460ac38000],{"./node_modules/json-loader/index.js!./.cache/json/bootstrapping-du-projet-en-es-6.json":function(n,s){n.exports={data:{markdownRemark:{html:'<p><strong>Prérequis</strong></p>\n<p>Le projet va être développé avec :</p>\n<ul>\n<li><code>node.js</code> version 5.5.0</li>\n<li><code>npm</code> version 3.3.12</li>\n</ul>\n<p>J\'utilise <a href="https://github.com/creationix/nvm">nvm</a> pour gérer différentes versions de <code>node</code>, avec un peu de configuration de <code>npm</code> pour accélérer l\'installation des modules, et fixer leur version :</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> config <span class="token keyword">set</span> progress<span class="token operator">=</span>false\n<span class="token function">npm</span> config <span class="token keyword">set</span> save-prefix<span class="token operator">=</span><span class="token string">\'~\'</span>\n</code></pre>\n      </div>\n<h1>Transpilation avec Babel</h1>\n<p>Je vais utiliser <a href="https://babeljs.io/">Babel</a> pour transpiler le code ES6 en ES5. La version 6 a introduit une nouvelle organisation du projet. Il faut maintenant installer au minimum <strong>babel-core</strong>, sur lequel vont s\'appuyer tous les autres modules.</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> babel-core –save-dev\n</code></pre>\n      </div>\n<p>Ensuite, il faut installer <strong>babel-cli</strong> permettant entre autres de vérifier l\'environnement avec <strong>babel-doctor</strong> ainsi que <strong>babel-node</strong> qui lui permet de lancer des scripts ES6 avec node avec une transpilation dynamique (on a ainsi un <strong>REPL ES6</strong>).</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> babel-cli –save-dev\n</code></pre>\n      </div>\n<p>Enfin, Babel utilise maintenant un système de <strong>presets</strong> permettant de ne transpiler que ce qui sera nécessaire au code final en fonction de son environnement d\'exécution, en l\'occurrence le navigateur.</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> babel-preset-es2015\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code># package.json\n\n  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"babel-cli"</span><span class="token operator">:</span> <span class="token string">"~6.5.1"</span><span class="token punctuation">,</span>\n    <span class="token property">"babel-core"</span><span class="token operator">:</span> <span class="token string">"~6.5.1"</span><span class="token punctuation">,</span>\n    <span class="token property">"babel-preset-es2015"</span><span class="token operator">:</span> <span class="token string">"~6.5.0"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">"babel"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token string">"es2015"</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p><strong><em>Remarque :</em></strong> <em>J\'ai configuré le preset de Babel directement dans le fichier <code>package.json</code>. Il est également possible de réaliser cette configuration dans un fichier <code>.babelrc</code>.</em></p>\n<p>Je conseille la lecture de l\'article de <a href="https://twitter.com/jcse">Jean-Charles Sisk</a>, <a href="https://medium.com/@jcse/clearing-up-the-babel-6-ecosystem-c7678a314bf3#.nfrmt64p8">« <strong>*Clearing up the Babel 6 Ecosystem *</strong>»</a> pour avoir plus de détail sur Babel 6.</p>\n<p>Maintenant, il faut choisir si l\'on veut utiliser Babel :</p>\n<ul>\n<li><strong>dynamiquement</strong> directement au niveau du navigateur,</li>\n<li><strong>statiquement</strong> au niveau du serveur en générant un fichier .js transpilé, fichier qui sera ensuite appelé par le navigateur.</li>\n</ul>\n<p>C\'est la solution que je vais utiliser (expliquant la déclaration des modules Babel en dépendance de développement, puisque Babel ne sera jamais présent dans le js de production).\nEt pour cela, nous allons devoir passer par un autre outil : <a href="https://webpack.github.io/"><strong>Webpack</strong></a>.</p>\n<h1>Webpack</h1>\n<p>Webpack est un « <em>module bundler</em> » permettant de gérer notre code es6 écrit en module et générer un fichier final js utilisable dans le navigateur, en effectuant au passage la transpilation ES6 avec Babel.</p>\n<blockquote>\n<p>webpack takes modules with dependencies and generates static assets representing those modules.</p>\n</blockquote>\n<p>Webpack fait d\'ailleurs bien plus que cela comme cela sera vu plus tard. Pour le moment, installons le afin de faire un premier test de transpilage de deux modules ES6.\nTous les fichiers de cette phase de bootstraping sont créés dans le répertoire <code>/src</code> et utilisent la syntaxe ES6 pour la gestion des modules.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>├── src\n│   ├── css\n│   │   └── main.css\n│   ├── index.html\n│   └── js\n│       ├── main.js\n│       └── paris.js</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-html"><code><span class="token comment" spellcheck="true">&lt;!-- src/index.html --></span>\n\n<span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Road to Caen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Road to Caen - version 0.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>start_here<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>js/main.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token comment" spellcheck="true">// src/js/main.js</span>\n\n<span class="token keyword">import</span> city <span class="token keyword">from</span> <span class="token string">\'./paris\'</span><span class="token punctuation">;</span>\n\ndocument<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'start_here\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token string">`For the moment, you are in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code><span class="token comment" spellcheck="true">// src/js/city.js</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">\'Paris\'</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>Si l\'on essaye d\'ouvrir index.html directement dans le navigateur, on a logiquement une erreur :</p>\n<p><img src="/images/rtc_bootstrap/rtc_bootstrap_es6_in_browser_error.png" alt="De l&#x27;ES6 dans le navigateur"></p>\n<p>On va donc configurer webpack pour effectuer un build du fichier <code>main.js</code> dans le répertoire <code>/build</code>, obligant au passage à installer deux plugins:</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> webpack babel-loader copy-webpack-plugin –save-dev\n</code></pre>\n      </div>\n<ul>\n<li><strong>babel loader</strong> est un plugin webpack permettant d\'utiliser Babel dans Webpack</li>\n<li><strong>copy-webpack-plugin</strong> est un plugin webpack permettant de copier un fichier d\'un répertoire à un autre, éventuellement en le renommant.</li>\n</ul>\n<p>Je ne vais pas rentrer dans les détails de webpack (vous pouvez pour cela lire xxx ou xxx), mais le grand principe est :</p>\n<ul>\n<li>de déclarer une ou plusieurs sources d\'entrée (<code>entry</code>),</li>\n<li>de déclarer une ou plusieurs sources de sortie (<code>output</code>) correspondant aux entrées,</li>\n<li>des loaders pour les différents types d\'assets traités (dans l\'exemple à suivre, on utilise par exemple le <strong>babel-loader</strong> pour transpiler les fichiers js traités).</li>\n</ul>\n<p>On déclare aussi des plugins pour des cas particuliers, comme le plugin <strong>copy-webpack-plugin</strong> permettant de copier le fichier <code>/src/index.html</code> dans le répertoire cible <code>/build/</code>.</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># Fichier de configuration de webpack webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js à la racine du projet\n\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'copy-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> dirJs <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'src/js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dirHtml <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'src\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dirBuild <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n    entry<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dirJs<span class="token punctuation">,</span> <span class="token string">\'main.js\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        path<span class="token punctuation">:</span> dirBuild<span class="token punctuation">,</span>\n        filename<span class="token punctuation">:</span> <span class="token string">\'js/main.js\'</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        loaders<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n            <span class="token punctuation">{</span>\n                test<span class="token punctuation">:</span> <span class="token regex">/\\.js$/</span><span class="token punctuation">,</span>\n                loader<span class="token punctuation">:</span> <span class="token string">\'babel-loader\'</span><span class="token punctuation">,</span>\n                exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n        <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n            <span class="token punctuation">{</span>\n                <span class="token keyword">from</span><span class="token punctuation">:</span> dirHtml <span class="token operator">+</span> <span class="token string">\'/index.html\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    stats<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        colors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code>./node_modules/.bin/webpack\n</code></pre>\n      </div>\n<p>On retrouve au final un fichier <code>index.html</code> et <code>main.js</code> dans le répertoire <code>/build/</code>, que l\'on peut charger sans erreur dans un navigateur.</p>\n<h1>Un serveur de développement</h1>\n<p>On arrive donc à transpilet notre ES6 dans un fichier unique fichier js, et c\'est déjà chouette. Mais on ne va pas lancer un build à chaque modifications du code...\nPour éviter cela, on va installer le <strong>webpack-dev-server</strong>, et en profiter pour faire un makefile afin de faciliter le lancement des commandes (<code>make build</code> pour lancer un transpilation et <code>make run-dev</code> pour le lancement du serveur de dev), et permettre à d\'éventuels autre participants au projet de pouvoir facilement installer tout l\'environnement de développement (<code>make install</code>).</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> webpack-dev-server –save-dev\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-makefile"><code><span class="token comment" spellcheck="true"># makefile</span>\n\n<span class="token builtin">.PHONY</span><span class="token punctuation">:</span> default install run test build clean-build\n\n<span class="token symbol">default</span><span class="token punctuation">:</span> run-dev\n\n<span class="token symbol">install</span><span class="token punctuation">:</span>\n\t<span class="token operator">@</span>npm install\n\n<span class="token symbol">clean-build</span><span class="token punctuation">:</span>\n\t<span class="token operator">@</span>rm -rf ./build/*\n\n<span class="token symbol">build</span><span class="token punctuation">:</span> clean-build\n\t<span class="token operator">@</span>./node_modules/.bin/webpack\n\n<span class="token symbol">run-dev</span><span class="token punctuation">:</span> clean-build\n\t<span class="token operator">@</span>./node_modules/.bin/webpack-dev-server --hot --inline --port<span class="token operator">=</span>8080\n</code></pre>\n      </div>\n<p><strong><em>Remarque</em></strong> : <em>on pourrait aussi utiliser <code>npm</code> pour lancer ces commandes et éviter le <code>node_modules/.bin</code> vers les exécutables des outils. Mais par habitude, ce sera make.</em></p>\n<p>Le <strong>webpack-dev-server</strong> est très rapide (il charge le code en mémoire) et permet de faire du <em>live-reload</em> (option <code>–hot</code>). On transpile maintenant bien le code ES6 en js lisible par le navigateur à la volée.\nMais on ne gère que le js, alors que l\'on veut aussi avoir du css.</p>\n<h1>Webpack et le css</h1>\n<p>Pour gérer le css, on ajoute un nouveau plugin et un nouveau loader (pour du css simple, mais on pourra aussi par la suite "<em>pre-processer</em>" du <strong>sass</strong> par exemple, grace à d\'autres loaders).</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> style-loader --save-dev\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js\n\n<span class="token operator">...</span>\nmodule<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    loaders<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.css$/</span><span class="token punctuation">,</span>\n        loader<span class="token punctuation">:</span> <span class="token string">"style!css"</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token operator">...</span>\n</code></pre>\n      </div>\n<p>L\'étrangeté, c\'est l\'appel du css dans le <code>main.js</code>, et pas dans l\'<code>index.html</code> :</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># src<span class="token operator">/</span>js<span class="token operator">/</span>main<span class="token punctuation">.</span>js\n\n<span class="token keyword">import</span> <span class="token string">\'../css/main.css\'</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>Mais c\'est comme cela que l\'on va pouvoir gérer nos css avec Webpack, comme un module js.</p>\n<h1>Gestion des différents environnements</h1>\n<p> Il faut maintenant encore améliorer les choses afin de gérer :</p>\n<ul>\n<li>un <strong>sourcemap</strong> lorsque l\'on est en développement (on trouve sur la page <a href="https://github.com/ryanseddon/source-map/wiki/Source-maps:-languages,-tools-and-other-info">Source maps: languages, tools and other info</a> plein d\'informations sur les sourcemaps)</li>\n<li>la génération d\'un fichier js optimisé (minimisé) et d\'un fichier css séparé pour le site de production,</li>\n<li>quelques variables permettant de bien distinguer l\'environnement de développement et celui de production, comme le titre de la page, le nom du css et du js finale,</li>\n<li>la gestion du <strong><em>cache busting</em></strong> des assets.</li>\n</ul>\n<p> Pour cela on va utiliser quelques nouveaux modules et plugins webpack :</p>\n<ul>\n<li><a href="https://github.com/lorenwest/node-config"><strong>config</strong></a> permettant de gérer des fichiers de configuration différents entre le dev et la prod,</li>\n<li><a href="https://github.com/ampedandwired/html-webpack-plugin"><strong>html-webpack-plugin</strong></a> permettant de mieux gérer nos sorties webpack à partir d\'un template html,</li>\n<li><a href="https://github.com/webpack/extract-text-webpack-plugin"><strong>extract-text-webpack-plugin</strong></a> permettant de générer un fichier css final.</li>\n</ul>\n<p>Le plugin <strong>html-webpack-plugin</strong> est tout simplement génial, et je vous renvoie vers l\'article de <a href="http://www.jonathan-petitcolas.com/">Jonathan Petitcolas</a> pour découvrir tout son potentiel : <a href="http://marmelab.com/blog/2016/01/26/webpack-html-plugin-in-a-nutshell.html">Webpack HTML plug-in in a nutshell</a>.\nLe module <strong>config</strong> va lui permettre de gérer un fichier de configuration (<code>config/default.js</code>) accessible depuis le code, et l\'on va pouvoir surcharger cette configuration selon les environnements de node <strong>NODE_ENV</strong>.</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> config  html-webpack-plugin  extract-text-webpack-plugin –save-dev\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>babel<span class="token punctuation">.</span>js\n\n<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">\'path\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> plugins <span class="token keyword">from</span> <span class="token string">\'./webpack/plugins\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> ExtractTextPlugin <span class="token keyword">from</span> <span class="token string">\'extract-text-webpack-plugin\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> dirJs <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'src/js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dirHtml <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'src\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dirBuild <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n    entry<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dirJs<span class="token punctuation">,</span> <span class="token string">\'main.js\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        path<span class="token punctuation">:</span> dirBuild<span class="token punctuation">,</span>\n        filename<span class="token punctuation">:</span> <span class="token string">\'js/road_to_caen.js\'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// On génère un fichier js final nommé</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        loaders<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n            <span class="token punctuation">{</span>\n                test<span class="token punctuation">:</span> <span class="token regex">/\\.js$/</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// le loader des fichiers js</span>\n                loader<span class="token punctuation">:</span> <span class="token string">\'babel-loader\'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// on transpile l\'ES6 avec Babel</span>\n                exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">{</span>\n                test<span class="token punctuation">:</span> <span class="token regex">/\\.css$/</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// le loader des css</span>\n                <span class="token comment" spellcheck="true">// Ici on traite différemment le css selon l\'environnement : en dev on l\'inject avec le javascript</span>\n                <span class="token comment" spellcheck="true">// en prod, on génère un fichier css distinct grace au extract-text-webpack-plugin</span>\n                loader<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'dev\'</span> <span class="token operator">?</span> <span class="token string">\'style!css\'</span> <span class="token punctuation">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token string">"style-loader"</span><span class="token punctuation">,</span> <span class="token string">"css-loader"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    plugins<span class="token punctuation">:</span> <span class="token function">plugins</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV<span class="token punctuation">,</span> dirHtml<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// On appel un fichier de conf des plugin distinct en passant l\'environnement</span>\n    stats<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        colors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment" spellcheck="true">// On va créer un fichier sourcemap si l\'on est en environnement de développement</span>\n    devtool<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">\'dev\'</span> <span class="token operator">?</span> <span class="token string">\'source-map\'</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># webpack<span class="token operator">/</span>plugin<span class="token punctuation">.</span>js\n\n<span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">\'config\'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// on appel le module de configuration</span>\n<span class="token keyword">import</span> ExtractTextPlugin <span class="token keyword">from</span> <span class="token string">\'extract-text-webpack-plugin\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> HtmlWebpackPlugin <span class="token keyword">from</span> <span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">\'webpack\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>env<span class="token punctuation">,</span> dirHtml<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> pluginsArray <span class="token operator">=</span> <span class="token punctuation">[</span>\n        <span class="token comment" spellcheck="true">// Avoid publishing files when compilation fails</span>\n        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NoErrorsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            hash<span class="token punctuation">:</span> env <span class="token operator">===</span> <span class="token string">\'prod\'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// ici, on génère le cache busting des assets si l\'on est en prod</span>\n            title<span class="token punctuation">:</span> config<span class="token punctuation">.</span>app_name<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// définit une variable utilisable dans le template html. On recupère le titre depuis la config</span>\n            template<span class="token punctuation">:</span> dirHtml <span class="token operator">+</span> <span class="token string">\'/index.html\'</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">===</span> <span class="token string">\'prod\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        pluginsArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>\n            <span class="token comment" spellcheck="true">// Ici on configure le plugin permettant de générer le fichier css de production</span>\n            <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">\'css/road_to_caen.css\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n                allChunks<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> pluginsArray<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p><strong><em>Remarque</em></strong> : <em>Le fichier de configuration de webpack a été renommé en <code>webpack.config.babel.js</code>: c\'est ce qui permet d\'utiliser de l\'ES6 dans ce fichier js :).</em></p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># src<span class="token operator">/</span>index<span class="token punctuation">.</span>html\n\n<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>\n<span class="token operator">&lt;</span>html<span class="token operator">></span>\n<span class="token operator">&lt;</span>head<span class="token operator">></span>\n    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> On utilise la variable options de webpack <span class="token operator">--</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> htmlWebpackPlugin<span class="token punctuation">.</span>options<span class="token punctuation">.</span>title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Plus besoin d<span class="token string">\'appeller le fichier css, webpack va injecter l\'</span>appel pour la production <span class="token operator">--</span><span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>\n<span class="token operator">&lt;</span>body<span class="token operator">></span>\n\n<span class="token operator">&lt;</span>h1<span class="token operator">></span>Road to Caen <span class="token operator">-</span> version <span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>\n\n<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"start_here"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Plus besoin d<span class="token string">\'appeller le fichier js, webpack va injecter l\'</span>appel pour la production <span class="token operator">--</span><span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># build<span class="token operator">/</span>index<span class="token punctuation">.</span>html <span class="token operator">-</span> le fichier html final de production\n\n<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>\n<span class="token operator">&lt;</span>html<span class="token operator">></span>\n<span class="token operator">&lt;</span>head<span class="token operator">></span>\n    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> On a bien le nom de production défini dans le fichier config<span class="token operator">/</span>prod<span class="token punctuation">.</span>js <span class="token operator">--</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span>title<span class="token operator">></span>Road to Caen<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> L\'appel au fichier css final est bien fait<span class="token punctuation">,</span> avec du cache busting<span class="token punctuation">.</span> Ce fichier est bien minifié  <span class="token operator">--</span><span class="token operator">></span>\n<span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">"css/road_to_caen.css?e79fbcf65e16662aa388"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>\n<span class="token operator">&lt;</span>body<span class="token operator">></span>\n\n<span class="token operator">&lt;</span>h1<span class="token operator">></span>Road to Caen <span class="token operator">-</span> version <span class="token number">0.1</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>\n\n<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"start_here"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> L\'appel au fichier js final est bien fait<span class="token punctuation">,</span> avec du cache busting<span class="token punctuation">.</span> Ce fichier est bien minifié <span class="token operator">--</span><span class="token operator">></span>\n<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/road_to_caen.js?e79fbcf65e16662aa388"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-makefile"><code><span class="token comment" spellcheck="true"># makefile</span>\n\n<span class="token builtin">.PHONY</span><span class="token punctuation">:</span> default install run test build clean-build\n\n<span class="token symbol">default</span><span class="token punctuation">:</span> run-dev\n\n<span class="token symbol">install</span><span class="token punctuation">:</span>\n    <span class="token operator">@</span>npm install\n\n<span class="token symbol">clean-build</span><span class="token punctuation">:</span>\n    <span class="token operator">@</span>rm -rf ./build/*\n\n<span class="token symbol">build</span><span class="token punctuation">:</span> clean-build\n    <span class="token comment" spellcheck="true"># On défini l\'environnement de node comme prod pour le build de production</span>\n    <span class="token comment" spellcheck="true"># On ajoute l\'option -p (production) pour la minification des assets</span>\n    <span class="token comment" spellcheck="true"># --progress permet de visualiser l\'avancement du build sur la console</span>\n    <span class="token operator">@</span>NODE_ENV<span class="token operator">=</span>prod ./node_modules/.bin/webpack -p --progress\n\n<span class="token symbol">run-dev</span><span class="token punctuation">:</span> clean-build\n    <span class="token comment" spellcheck="true"># On défini l\'environnement de node comme dev pour le webpack-dev-server</span>\n    <span class="token operator">@</span>NODE_ENV<span class="token operator">=</span>dev ./node_modules/.bin/webpack-dev-server --hot --inline --port<span class="token operator">=</span>8080\n</code></pre>\n      </div>\n<h1>Les tests unitaires</h1>\n<p>On y est presque ! Mais il manque encore les tests unitaires qui seront réalisés avec <a href="https://mochajs.org/">mocha</a> et <a href="http://chaijs.com/">chai</a>.</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> mocha chai --save-dev\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-makefile"><code><span class="token comment" spellcheck="true"># makefile</span>\n\n<span class="token symbol">test-unit</span><span class="token punctuation">:</span>\n    <span class="token comment" spellcheck="true"># On indique à mocha ou trouver les fichiers de test : src/js/**/*.spec.js</span>\n    <span class="token comment" spellcheck="true"># On ajoute un compileur à mocha, pour pouvoir écrire les tests en ES6 : --compilers js:babel-core/register</span>\n    <span class="token comment" spellcheck="true"># On configure la sortie de console de mocha avec --reporter spec --ui bdd</span>\n    <span class="token operator">@</span>NODE_ENV<span class="token operator">=</span>test node_modules/.bin/mocha src/js/**/*.spec.js --compilers js<span class="token punctuation">:</span>babel-core/register --reporter spec --ui bdd --timeout 5000\n</code></pre>\n      </div>\n<p>Concernant les fichiers de tests unitaires, je trouve cela plus pratique et plus cohérent de créer le fichier à côté du fichier testé unitairement en rajoutant un <code>.spec</code>, plutôt que de les mettre dans un répertoire <code>/tests</code> distinct.</p>\n<div class="gatsby-highlight">\n      <pre class="language-none"><code>├── src\n│   ├── css\n│   │   └── main.css\n│   ├── index.html\n│   └── js\n│       ├── main.js\n│       ├── paris.js\n│       └── paris.spec.js</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># src<span class="token operator">/</span>js<span class="token operator">/</span>paris<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>js\n\n<span class="token keyword">import</span> city <span class="token keyword">from</span> <span class="token string">\'./paris\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> assert <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'chai\'</span><span class="token punctuation">;</span>\n\n<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">\'city\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'should export "Paris" as city\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>\n        assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span> <span class="token string">\'Paris\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<h1>Les tests fonctionnels</h1>\n<p>Pour que les tests soient complets, il manque encore les tests fonctionnels. Pour les réaliser, je vais utiliser <a href="http://nightwatchjs.org/">Nightwatch</a>.\nMais tout d\'abord, pour faire des tests fonctionnels, on va avoir besoin d\'un build de prod et d\'un serveur permettant à Nightwatch d\'appeler une URL à tester.</p>\n<p>L\'exposition http des fichiers statiques finaux sera assurée par <a href="https://github.com/indexzero/http-server">http-server</a>.  Lors de l\'execution des tests, il va falloir gérer :</p>\n<ul>\n<li>\n<ol>\n<li>le lancement du serveur des statiques</li>\n</ol>\n</li>\n<li>\n<ol start="2">\n<li>le lancement d\'un serveur <a href="http://www.seleniumhq.org/">selenium</a></li>\n</ol>\n</li>\n<li>\n<ol start="3">\n<li>l\'execution des tests</li>\n</ol>\n</li>\n<li>\n<ol start="4">\n<li>l\'arrêt du selenium</li>\n</ol>\n</li>\n<li>\n<ol start="5">\n<li>l\'arrêt du serveur de statiques</li>\n</ol>\n</li>\n</ul>\n<p>Cela peut se gérer via les <code>PID</code> des instances de serveurs</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code>start-static-server: static-server.PID\nstatic-server.PID:\n\t@echo <span class="token string">"Starting static server"</span>\n\t@cd ./build <span class="token operator">&amp;&amp;</span> <span class="token punctuation">{</span> <span class="token punctuation">..</span>/node_modules/.bin/http-server -p 8081 <span class="token operator">&amp;</span> <span class="token keyword">echo</span> $<span class="token variable">$!</span> <span class="token operator">></span> <span class="token punctuation">..</span>/<span class="token variable">$@</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> <span class="token punctuation">..</span>\nstop-static-server: static-server.PID\n\t@kill <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $<span class="token operator">&lt;</span><span class="token variable">`</span></span> <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> $<span class="token operator">&lt;</span>\n</code></pre>\n      </div>\n<p>Mais je n\'aime pas trop cette solution, qui présente entre l\'autre l\'inconvéniant de laisser trainer des fichiers <code>.PID</code> en cas d\'échec des tests, empêchant la relance des serveurs après correctif.\nJ\'ai trouvé une solution plus élégante consistant à utiliser <a href="http://pm2.keymetrics.io/">PM2</a> pour gérer les serveurs lors des tests. J\'ai soumis cette solution à mes <a href="http://marmelab.com/">éminents collègues marmelabien</a> et en fonction de leurs retours, je ferais un petit post spécifique sur l\'utilisation de PM2 en environnement de développement et de tests.\nMais voici ce que cela donne pour <em>Road to Caen</em> :</p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> nightwatch selenium-standalone pm2 --save-dev\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code># rtc_functional_test.json <span class="token operator">:</span> le fichier de configuration des serveurs de PM2\n\n<span class="token punctuation">{</span>\n  <span class="token property">"apps"</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n    <span class="token property">"name"</span>       <span class="token operator">:</span> <span class="token string">"rtc-static-server"</span><span class="token punctuation">,</span> // le nom du serveur\n    <span class="token property">"script"</span>     <span class="token operator">:</span> <span class="token string">"./node_modules/.bin/http-server"</span><span class="token punctuation">,</span> // l\'appel au serveur\n    <span class="token property">"args"</span>       <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./build"</span><span class="token punctuation">,</span> <span class="token string">"-p 8088"</span><span class="token punctuation">,</span> <span class="token string">"--silent"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> // les options\n    <span class="token property">"instances"</span>  <span class="token operator">:</span> <span class="token number">1</span>\n  <span class="token punctuation">}</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code># nightwatch.json <span class="token operator">:</span> le fichier de configuration de Nightwatch\n\n<span class="token punctuation">{</span>\n    <span class="token property">"src_folders"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./test-functional/"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> // repertoire des tests fonctionnels\n    <span class="token property">"output_folder"</span><span class="token operator">:</span> <span class="token string">"./test-functional/reports"</span><span class="token punctuation">,</span> // repertoire des rapports de tests\n    <span class="token property">"custom_commands_path"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n    <span class="token property">"custom_assertions_path"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n    <span class="token property">"globals_path"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n\n    <span class="token property">"selenium"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"start_process"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> // Nightwatch se charge de lancer et d\'eteindre selenium !\n        <span class="token property">"server_path"</span><span class="token operator">:</span> <span class="token string">"./node_modules/selenium-standalone/.selenium/selenium-server/2.48.2-server.jar"</span><span class="token punctuation">,</span>\n        <span class="token property">"log_path"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n        <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>\n        <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">4444</span><span class="token punctuation">,</span>\n        <span class="token property">"cli_args"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n            <span class="token property">"webdriver.chrome.driver"</span><span class="token operator">:</span> <span class="token string">"./node_modules/selenium-standalone/.selenium/chromedriver/2.21-x64-chromedriver"</span><span class="token punctuation">,</span>\n            <span class="token property">"webdriver.ie.driver"</span><span class="token operator">:</span> <span class="token string">""</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n    <span class="token property">"test_settings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"default"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n            <span class="token property">"launch_url"</span><span class="token operator">:</span> <span class="token string">"http://localhost:8088"</span><span class="token punctuation">,</span>\n            <span class="token property">"selenium_port"</span><span class="token operator">:</span> <span class="token number">4444</span><span class="token punctuation">,</span>\n            <span class="token property">"selenium_host"</span><span class="token operator">:</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span>\n            <span class="token property">"silent"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token property">"firefox_profile"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            <span class="token property">"desiredCapabilities"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n                <span class="token property">"browserName"</span><span class="token operator">:</span> <span class="token string">"chrome"</span><span class="token punctuation">,</span>\n                <span class="token property">"javascriptEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n                <span class="token property">"acceptSslCerts"</span><span class="token operator">:</span> <span class="token boolean">true</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token property">"screenshots"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n                <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n                <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"./test-functional/screen-caps"</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token property">"desiredCapabilities"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n              <span class="token property">"browserName"</span><span class="token operator">:</span> <span class="token string">"firefox"</span><span class="token punctuation">,</span>\n              <span class="token property">"javascriptEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n              <span class="token property">"acceptSslCerts"</span><span class="token operator">:</span> <span class="token boolean">true</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token property">"firefox"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n            <span class="token property">"desiredCapabilities"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n                <span class="token property">"browserName"</span><span class="token operator">:</span> <span class="token string">"firefox"</span><span class="token punctuation">,</span>\n                <span class="token property">"javascriptEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token property">"chrome"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n            <span class="token property">"desiredCapabilities"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n                <span class="token property">"browserName"</span><span class="token operator">:</span> <span class="token string">"chrome"</span><span class="token punctuation">,</span>\n                <span class="token property">"javascriptEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-makefile"><code><span class="token comment" spellcheck="true"># makefile</span>\n<span class="token builtin">.PHONY</span><span class="token punctuation">:</span> default install run test build clean-build\n\n<span class="token symbol">install</span><span class="token punctuation">:</span>\n    <span class="token operator">@</span>npm install\n    <span class="token comment" spellcheck="true"># On lance l\'installation du serveur selenium</span>\n    <span class="token operator">@</span>node_modules/.bin/selenium-standalone install --version<span class="token operator">=</span>2.48.2\n\n\n<span class="token symbol">test-functional</span><span class="token punctuation">:</span> clean-build\n    <span class="token comment" spellcheck="true"># lancement du build des fichiers statiques finaux identiques à la prod</span>\n    <span class="token operator">@</span>make build\n    <span class="token comment" spellcheck="true"># lancement du serveur statique avec pm2 en indiquant le fichier de configuration du serveur</span>\n    <span class="token operator">@</span>node_modules/.bin/pm2 start rtc_functional_tests.json\n    <span class="token comment" spellcheck="true"># lancement de nightwatch, qui va se charger de l\'instance de selenium</span>\n    <span class="token operator">@</span>node_modules/.bin/nightwatch\n    <span class="token comment" spellcheck="true"># arret du serveur statique</span>\n    <span class="token operator">@</span>node_modules/.bin/pm2 stop rtc-static-server\n</code></pre>\n      </div>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code># test<span class="token operator">-</span>functional<span class="token operator">/</span>home<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>js <span class="token punctuation">:</span> fichier de tests de l\'accueil du site\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token string">\'Display Home\'</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>client<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        client\n            <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">\'http://localhost:8088\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        client<span class="token punctuation">.</span>expect<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>present<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        client<span class="token punctuation">.</span>expect<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token string">\'#start_here\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">\'For the moment, you are in Paris\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        client<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p><strong><em>Remarque</em></strong> : <em>Je n\'ai pas encore trouver comment écrire les tests fonctionnels en ES6 :(</em></p>\n<h1>La touche finale: le « code styling »</h1>\n<p>Pour terminer cet environnement de développement ES6, on va ajouter un dernier outil permettant d\'être cohérent sur le code styling du projet : <a href="http://eslint.org/">ESLint</a></p>\n<div class="gatsby-highlight">\n      <pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> eslint eslint-config-airbnb eslint-plugin-mocha --save-dev\n</code></pre>\n      </div>\n<p>Eslint se configure dans un fichier <code>.eslintrc</code> :</p>\n<div class="gatsby-highlight">\n      <pre class="language-json"><code><span class="token punctuation">{</span>\n    <span class="token property">"extends"</span><span class="token operator">:</span> <span class="token string">"airbnb"</span><span class="token punctuation">,</span>\n    <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"mocha"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token property">"rules"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"indent"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>J\'utilise le preset airbnb, qui gère bien l\'ES6, mais aussi la syntaxe particulière de Redux. Je ne lance pas de tests directement avec ESLint, mais j\'utilise avec <a href="https://atom.io/">ATOM</a> le plugin <a href="https://atom.io/packages/linter-eslint">linter-eslint</a>.</p>\n<h1>Conclusion</h1>\n<p>Alors, <a href="https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4#.6bg742tti"><strong><em>JavaScript fatigue</em></strong></a> ? Il est vrai que cette phase de bootstraping est assez longue, et oblige à voir et comprendre pas mal d\'outils. Un <code>ls</code> dans le répertoire des <code>node_modules</code> est plutôt impressionnant ! On est tenté de se dire : <em>tout ça pour générer un (encore) pauvre fichier js final ?</em>\nEh bien oui, mais j\'oppose à cela plusieurs remarques.</p>\n<p>Tout d\'abord, on est en présence d\'un environnement de développement complet permettant :</p>\n<ul>\n<li>d\'écrire en ES6 du code qui sera lisible sur tout les navigateurs,</li>\n<li>de générer des assets finaux optimisés,</li>\n<li>de disposer d\'un serveur de développement très rapide assurant le live-reload,</li>\n<li>d\'écrire des tests unitaires et fonctionnels,</li>\n<li>de s\'assurer de la cohérence de la syntaxe du projet.</li>\n</ul>\n<p><img src="/images/rtc_bootstrap/rtcBootstrapOk.gif" alt="L&#x27;environnement final"></p>\n<p>Ensuite, toutes ces librairies et autres modules envahissant le répertoire <code>node_modules</code> ne sont là <strong>que pour l\'environnement de développement</strong>. Rien de cela n\'est visible au final sur ce qui sera mis en production.\nC\'est donc une espèce d\'usine Lego à produire du code final optimisé, pas de la surcharge de code.</p>\n<p>Et ceci nous oblige en tant que développeur a bien connaître et si possible à maitriser ces outils, plutôt que de les avoir comme une boite noire intégrée à un IDE :)</p>\n<p>En plus, un simple <code>make install</code>, et "<strong><em>tadam</em></strong>", tout est prêt !</p>\n<p>Si vous voulez voir un autre bootstraping encore plus complet, car intégrant un serveur back en <a href="http://koajs.com/">Koa</a> et un front en <a href="https://facebook.github.io/react/">React</a>/<a href="http://redux.js.org/">Redux</a>, vous pouvez jeter un coup d\'oeil à ce dépôt : <a href="https://github.com/marmelab/javascript-boilerplate">marmelab/javascript-boilerplate</a>.</p>\n<p>Tout le code du bootstrap de <code>Road to Caen</code> est également disponible sur Github : <a href="https://github.com/alexisjanvier/road-to-caen/releases/tag/v0.1.0">alexisjanvier/road-to-caen</a></p>\n<p>La prochaine étape, donc le prochain post, abordera la question du <strong>déploiement continu du projet</strong>.</p>',
frontmatter:{title:"Bootstraping du projet ES6",date:"2016-02-09",tags:["es6","babel","webpack"],description:"L’application « Road to Caen » va donc être codée en ES6. L’idée est d’écrire du JavaScript qui ne pourra pas être nativement interprété par le navigateur, mais devra passer par une première phase de transpilation d’ES6 en ES5. Pour cela, il va falloir bootstrapper le projet avec pas mal d’outils (cause chez quelques-uns d’une certaine fatigue…)."}}},pathContext:{slug:"bootstrapping_du_projet_en_es6"}}}});
//# sourceMappingURL=path---bootstrapping-du-projet-en-es-6-7a41039d1bcd333ae943.js.map